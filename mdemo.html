<!doctype html>
<html>
<head>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">

<style>
/*@media (min-width: 512px) {
	.container { max-width: 1536px; }
}
*/
body {
	font-family: Arial, serif;
	font-size:13px;
	color: #555;
	padding-top:10px;
}

h1, .h1, h2,.h2, h3,.h3, h4, .h4, h5, .h5, h6, .h6 {
	font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
	font-weight: 400;
	color: #333;
}
canvas {
	cursor:pointer;
}
</style>
</head>

<body>
	<div class="container">
		<h1>Relight!</h1>
		<p>Click and drag on the image to test the RTI dataset</p>
		<!-- Change width and height to match your dataset -->
		<canvas id="rticanvas" width="512" height="512"></canvas>
	</div>
</body>

<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
<script src="mrelight.js"></script>
<script>

//Change this to your dataset
var url = 'test/coin10.ycc1044';

var zoom = 1;

var canvas = $('#rticanvas');


var glopt = { antialias: false, depth: false };
var gl = canvas[0].getContext("webgl2", glopt) || canvas.getContext("webgl", glopt) || canvas.getContext("experimental-webgl", glopt) ;
var rti = new MRti('#rticanvas', {gl:gl});
rti.setUrl(url);
rti.onLoad = function(t) {
	t.computeLightWeights([0, 0, 1]);
	t.draw(zoom);
}

var scrolling = null;

canvas.mousedown(function(e) {
	if(e.button != 0) return;
	scrolling = { 
		x: e.pageX - $(this).offset().left, 
		y: e.pageY - $(this).offset().top
	};
});

canvas.mousemove(function(e) {
	if(!scrolling) return;
	var c = $(e.target);

	var w = c.width();
	var h = c.height();
	var x = e.pageX - $(this).offset().left;
	var y = e.pageY - $(this).offset().top; 
	x = (w - x)/w*2 - 1;
	y = (h - y)/h*2 - 1;
	var r = Math.sqrt(x*x + y*y);
	if(r > 1.0) {
		x /= r;
		y /= r;
		r = 1.0;
	}
	var z = Math.sqrt(1 - r);

	rti.computeLightWeights([-x, y, z]);
	rti.draw(zoom);
});

canvas.mouseup(function(e) { scrolling = null; });


</script>
</html>


